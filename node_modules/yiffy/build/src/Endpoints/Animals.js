"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const Constants_1 = require("../util/Constants");
const ErrorHandler_1 = __importDefault(require("../util/ErrorHandler"));
const get_1 = __importDefault(require("../util/get"));
const perf_hooks_1 = require("perf_hooks");
class Animals {
    options;
    constructor(d) {
        if (!d)
            d = {};
        this.options = {
            userAgent: d.userAgent || Constants_1.USER_AGENT,
            apiKey: d.apiKey || "",
            debug: d.debug || (() => null),
            baseURL: d.baseURL || Constants_1.API_URL,
            host: d.host || Constants_1.API_HOST
        };
    }
    async sendRequest(cat, method, amount, maxImageSize) {
        if (!cat)
            throw new TypeError("missing category");
        if (!method)
            method = "json";
        method = method.toLowerCase();
        if (["image"].includes(method) && amount && amount > 1)
            throw new TypeError("Ammount cannot be greater than one when requesting an image or stream.");
        if (amount && amount > 5)
            throw new TypeError("Amount cannot be greater than five.");
        const h = {};
        if (this.options.apiKey)
            h.Authorization = this.options.apiKey;
        switch (method) {
            case "image": {
                const start = perf_hooks_1.performance.now();
                const r = await (0, get_1.default)(`${this.options.baseURL}/animals/${cat}/image?notes=disabled${maxImageSize ? `&sizeLimit=${maxImageSize}` : ""}`, this.options.userAgent, this.options.apiKey);
                const end = perf_hooks_1.performance.now();
                if (r.statusCode !== 200) {
                    const e = (0, ErrorHandler_1.default)(r.statusCode);
                    if (!e)
                        throw new TypeError(`Non 200-OK status code returned from api: ${r.statusCode} ${r.statusMessage}`);
                    else
                        throw new TypeError(e);
                }
                const d = {
                    artists: [],
                    sources: [],
                    width: 0,
                    height: 0,
                    url: "",
                    shortURL: "",
                    reportURL: "",
                    type: "",
                    name: "",
                    ext: "",
                    size: 0
                };
                // I'm not sure if the any spam or this is better,
                // both are type abuse
                Object.keys(r.headers).map((hr) => {
                    if (Object.values(Constants_1.API_HEADERS).includes(hr[0])) {
                        const n = Object.keys(Constants_1.API_HEADERS)[Object.values(Constants_1.API_HEADERS).indexOf(hr)];
                        if (d[n] instanceof Array)
                            d[n].push(...(Array.isArray(r.headers[hr]) ? r.headers[hr] : [r.headers[hr]]));
                        else if (typeof d[n] === "number")
                            d[n] = Number(r.headers[hr]);
                        else
                            d[n] = r.headers[hr];
                    }
                });
                if (r.statusCode !== 200) {
                    let v;
                    try {
                        v = JSON.parse(r.body.toString());
                    }
                    catch (e) {
                        v = r.body.toString();
                    }
                    const e = (0, ErrorHandler_1.default)(r.statusCode);
                    // eslint-disable-next-line @typescript-eslint/restrict-template-expressions
                    if (!e)
                        throw new TypeError(`Non 200-OK status code returned from api: ${r.statusCode} ${r.statusMessage} (${typeof v === "string" ? v : v.error})`);
                    else
                        throw new TypeError(e);
                }
                this.debug(`${this.options.baseURL}/animals/${cat}/image?notes=disabled${maxImageSize ? `&sizeLimit=${maxImageSize}` : ""}`, { start, end, time: parseFloat((end - start).toFixed(2)) });
                return {
                    image: r.body,
                    data: d
                };
                break;
            }
            case "json": {
                const start = perf_hooks_1.performance.now();
                const r = await (0, get_1.default)(`${this.options.baseURL}/animals/${cat}?notes=disabled${maxImageSize ? `&sizeLimit=${maxImageSize}` : ""}`, this.options.userAgent, this.options.apiKey);
                const end = perf_hooks_1.performance.now();
                if (r.statusCode !== 200) {
                    let v;
                    try {
                        v = JSON.parse(r.body.toString());
                    }
                    catch (e) {
                        v = r.body.toString();
                    }
                    const e = (0, ErrorHandler_1.default)(r.statusCode);
                    if (!e)
                        throw new TypeError(`Non 200-OK status code returned from api: ${r.statusCode} ${r.statusMessage} (${typeof v === "string" ? v : v.error})`);
                    else
                        throw new TypeError(e);
                }
                let b;
                try {
                    b = JSON.parse(r.body.toString());
                }
                catch (e) {
                    throw new TypeError(`Error parsing JSON body: ${e.stack}`);
                }
                this.debug(`${this.options.baseURL}/animals/${cat}?notes=disabled${maxImageSize ? `&sizeLimit=${maxImageSize}` : ""}`, { start, end, time: parseFloat((end - start).toFixed(2)) });
                return amount === 1 ? b.images[0] : b.images;
                break;
            }
            // eslint-disable-next-line @typescript-eslint/restrict-template-expressions
            default: throw new TypeError(`Unknown method "${method}"`);
        }
    }
    get birb() { return this.sendRequest.bind(this, "birb"); }
    get blep() { return this.sendRequest.bind(this, "blep"); }
    get cheeta() { return this.sendRequest.bind(this, "cheeta"); }
    get dikdik() { return this.sendRequest.bind(this, "dikdik"); }
    get fox() { return this.sendRequest.bind(this, "fox"); }
    get lynx() { return this.sendRequest.bind(this, "lynx"); }
    get wolf() { return this.sendRequest.bind(this, "wolf"); }
    get debug() { return this.options.debug; }
}
exports.default = Animals;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQW5pbWFscy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9FbmRwb2ludHMvQW5pbWFscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLGlEQUErRTtBQVEvRSx3RUFBZ0Q7QUFDaEQsc0RBQThCO0FBQzlCLDJDQUF5QztBQUV6QyxNQUFxQixPQUFPO0lBQzNCLE9BQU8sQ0FBVTtJQUNqQixZQUFZLENBQW9CO1FBQy9CLElBQUksQ0FBQyxDQUFDO1lBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUNmLElBQUksQ0FBQyxPQUFPLEdBQUc7WUFDZCxTQUFTLEVBQUUsQ0FBQyxDQUFDLFNBQVMsSUFBSSxzQkFBVTtZQUNwQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLE1BQU0sSUFBSSxFQUFFO1lBQ3RCLEtBQUssRUFBRSxDQUFDLENBQUMsS0FBSyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDO1lBQzlCLE9BQU8sRUFBRSxDQUFDLENBQUMsT0FBTyxJQUFJLG1CQUFPO1lBQzdCLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxJQUFJLG9CQUFRO1NBQ3hCLENBQUM7SUFDSCxDQUFDO0lBS08sS0FBSyxDQUFDLFdBQVcsQ0FBQyxHQUFvQixFQUFFLE1BQXlCLEVBQUUsTUFBMEIsRUFBRSxZQUFxQjtRQUMzSCxJQUFJLENBQUMsR0FBRztZQUFFLE1BQU0sSUFBSSxTQUFTLENBQUMsa0JBQWtCLENBQUMsQ0FBQztRQUNsRCxJQUFJLENBQUMsTUFBTTtZQUFFLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDN0IsTUFBTSxHQUFHLE1BQU0sQ0FBQyxXQUFXLEVBQW1CLENBQUM7UUFDL0MsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxNQUFNLElBQUksTUFBTSxHQUFHLENBQUM7WUFBRSxNQUFNLElBQUksU0FBUyxDQUFDLHdFQUF3RSxDQUFDLENBQUM7UUFDdEosSUFBSSxN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